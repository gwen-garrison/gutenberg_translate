{% extends 'base.html' %}

{% block body %}
    <div id="user_controls">
        <h3>{{ book_obj.name }} by {{ book_obj.author }} in {{ language }}</h3>
        <form id="chosen_chap_form" method="GET">
            <div class="form-group">
                <label for="sel1">Chapter:</label>
                <select name="chapter_selection" class="form-control" id="sel1">
                    {% for chapter_number in range(1, number_of_chapters) %}
                    {% if chapter_number == chapter_chosen %}
                    <option value="{{ chapter_number|string() }}" selected="selected">Chapter {{ chapter_number }}</option>
                    {% else %}
                    <option value="{{ chapter_number|string() }}">Chapter {{ chapter_number }}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
            <input type="hidden" value="{{ bookgroup_id }}" name="bookgroup_id_input">
            <input type="hidden" value="{{ book_id }}" name="hidden_bookid_input">
            <input type="hidden" value="{{ language }}" name="hidden_lang_input">
            <input type="hidden" value="{{ group_id }}" name="hidden_groupid_input">
            <button id="chosen_chap_submit" type="submit">Choose</button>
        </form>
    </div>

    <div class="book-info">
        <div class="row">
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                {% if chapter_chosen %}
                <h2>Chapter {{ chapter_chosen }}</h2>
                {% else %}
                <h2>Chapter 1</h2>
                {% endif %}
            </div>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <h2>Translations</h2>
            </div>
        </div>
    </div>


    <div id="wrapper">
        <div class="modal fade" id="add_translation_section" tabindex="-1" role="dialog" 
                aria-labelledby="myLargeModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title text-center">
                        Translation
                    </h1>
                </div>

                <div class="modal-body" id="translation_form">
                    <div id="current_untans_text" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                        <p></p>
                    </div>
                    <form name="text_form" method="POST" action="/save_text"
                        id="translate_textarea" data-bookgroupid = "{{ bookgroup_id }}"
                        class="col-xs-6 col-sm-6 col-md-6 col-lg-6 col-xs-offset-6 col-md-offset-6 col-lg-offset-6">
                        <div class="form-group">Translate :<br>
                            <textarea name="translated_text" id="text_form_ta"
                            placeholder="Enter text here!" required></textarea>
                        </div><br>
                        <input type="hidden" name="hidden_book_id_input" value="{{ book_id }}">
                        <input type="button" value="submit" id="submit_bttn" data-dismiss="modal" class="btn btn-primary btn-sm btn-block">
                    </form>
                </div>

                <div class="modal-body" id="error_translation_in_progress">
                    <p>A user is already translating this paragrap.</p>
                </div>

                <div class="modal-footer">
                    <div>
                        <button class="btn" id="cancel_translation_btn" data-dismiss="modal" aria-hidden="true">
                            Cancel
                        </button>
                        <button class="btn" id="confirm" data-dismiss="modal" aria-hidden="true">
                            Ok
                        </button>
                    </div>
                </div>
            </div>
          </div>
        </div>

        {%  for paragraph in display_chapter %}
        <div class="book_rendering row">
            <div class="untranslated col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <div class="a_chapter_and_bttn {{ paragraph.paragraph_id }}">
                    <p>{{ paragraph.untranslated_paragraph }}</p>
                    <button class="btn edit_text" data-toggle="modal"
                            data-target="#add_translation_section" data-paragraphid="{{ paragraph.paragraph_id }}">
                        <i class="fa fa-pencil-square-o"></i>
                    </button>
                </div>
            </div>

            <div class="trans_para col-xs-6 col-sm-6 col-md-6 col-lg-6" id="{{ paragraph.paragraph_id }}">
                {% if display_translations %}
                    {% for existing_translation in display_translations %}
                        {% if existing_translation.paragraph_id == paragraph.paragraph_id %}
                            <p>{{ existing_translation.translated_paragraph }}</p>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script type="text/javascript" src="/static/js/translations.js"></script>
{% endblock %}